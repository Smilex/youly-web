angular.module("zoidberg").controller("BlogCtrl",["$scope","$http","$modal","$state",function(e,o,l,t){function s(o){e.alert=!0,e.alert_class="alert-danger",e.alert_msg=o}function i(o){e.alert=!0,e.alert_class="alert-info",e.alert_msg=o}e.blog_edit={},e.blogs=[],e.headings=["Title","Author","Date","Published","Controls"],o.get("zoidberg/blogs").success(function(o){e.blogs=o}),e.dismiss=function(){e.alert=!1},e.publish_toggle=function(e){o.post("zoidberg/blogs/publish",{id:e._id,published:!e.published}).success(function(){e.published=!e.published,i(e.published?"'"+e.title+"' has been published.":"'"+e.title+"' has been unpublished.")}).error(function(){s("Failed to change publish status of blog")})},e.delete=function(t){var n=l.open({templateUrl:"blog_delete_modal.html",controller:["$scope","$modalInstance",function(e,o){e.blog=t,e.ok=function(){o.close()},e.cancel=function(){o.dismiss()}}]});n.result.then(function(){o.post("zoidberg/blogs/delete",{id:t._id}).success(function(){i("Successfully deleted blog");var o=e.blogs.indexOf(t);-1!=o&&e.blogs.splice(o,1)}).error(function(){s("Failed to delete blog")})})},e.edit=function(o){e.blog_edit=o,t.go("blogs.edit")},e.new=function(){e.blog_edit={},o.post("zoidberg/blogs/new",{}).success(function(o){e.blogs.push(o),e.blog_edit=e.blogs[e.blogs.length-1],t.go("blogs.edit")}).error(function(){s("Failed to create new blog")})},e.save=function(){o.post("zoidberg/blogs/save",e.blog_edit).success(function(){}).error(function(){s("Failed to save blog")})}}]);